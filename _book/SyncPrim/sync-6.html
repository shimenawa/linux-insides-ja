
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>SeqLock Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="sync-5.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Summary</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../Booting/">
            
                <a href="../Booting/">
            
                    
                    Booting
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../Booting/linux-bootstrap-1.html">
            
                <a href="../Booting/linux-bootstrap-1.html">
            
                    
                    From bootloader to kernel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../Booting/linux-bootstrap-2.html">
            
                <a href="../Booting/linux-bootstrap-2.html">
            
                    
                    First steps in the kernel setup code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../Booting/linux-bootstrap-3.html">
            
                <a href="../Booting/linux-bootstrap-3.html">
            
                    
                    Video mode initialization and transition to protected mode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../Booting/linux-bootstrap-4.html">
            
                <a href="../Booting/linux-bootstrap-4.html">
            
                    
                    Transition to 64-bit mode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../Booting/linux-bootstrap-5.html">
            
                <a href="../Booting/linux-bootstrap-5.html">
            
                    
                    Kernel decompression
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../Initialization/">
            
                <a href="../Initialization/">
            
                    
                    Initialization
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../Initialization/linux-initialization-1.html">
            
                <a href="../Initialization/linux-initialization-1.html">
            
                    
                    First steps in the kernel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../Initialization/linux-initialization-2.html">
            
                <a href="../Initialization/linux-initialization-2.html">
            
                    
                    Early interrupts handler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../Initialization/linux-initialization-3.html">
            
                <a href="../Initialization/linux-initialization-3.html">
            
                    
                    Last preparations before the kernel entry point
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../Initialization/linux-initialization-4.html">
            
                <a href="../Initialization/linux-initialization-4.html">
            
                    
                    Kernel entry point
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../Initialization/linux-initialization-5.html">
            
                <a href="../Initialization/linux-initialization-5.html">
            
                    
                    Continue architecture-specific boot-time initializations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../Initialization/linux-initialization-6.html">
            
                <a href="../Initialization/linux-initialization-6.html">
            
                    
                    Architecture-specific initializations, again...
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../Initialization/linux-initialization-7.html">
            
                <a href="../Initialization/linux-initialization-7.html">
            
                    
                    End of the architecture-specific initializations, almost...
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="../Initialization/linux-initialization-8.html">
            
                <a href="../Initialization/linux-initialization-8.html">
            
                    
                    Scheduler initialization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="../Initialization/linux-initialization-9.html">
            
                <a href="../Initialization/linux-initialization-9.html">
            
                    
                    RCU initialization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.10" data-path="../Initialization/linux-initialization-10.html">
            
                <a href="../Initialization/linux-initialization-10.html">
            
                    
                    End of initialization
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../interrupts/">
            
                <a href="../interrupts/">
            
                    
                    Interrupts
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../interrupts/interrupts-1.html">
            
                <a href="../interrupts/interrupts-1.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../interrupts/interrupts-2.html">
            
                <a href="../interrupts/interrupts-2.html">
            
                    
                    Start to dive into interrupts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../interrupts/interrupts-3.html">
            
                <a href="../interrupts/interrupts-3.html">
            
                    
                    Interrupt handlers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../interrupts/interrupts-4.html">
            
                <a href="../interrupts/interrupts-4.html">
            
                    
                    Initialization of non-early interrupt gates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../interrupts/interrupts-5.html">
            
                <a href="../interrupts/interrupts-5.html">
            
                    
                    Implementation of some exception handlers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../interrupts/interrupts-6.html">
            
                <a href="../interrupts/interrupts-6.html">
            
                    
                    Handling Non-Maskable interrupts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../interrupts/interrupts-7.html">
            
                <a href="../interrupts/interrupts-7.html">
            
                    
                    Dive into external hardware interrupts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../interrupts/interrupts-8.html">
            
                <a href="../interrupts/interrupts-8.html">
            
                    
                    Initialization of external hardware interrupts structures
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../interrupts/interrupts-9.html">
            
                <a href="../interrupts/interrupts-9.html">
            
                    
                    Softirq, Tasklets and Workqueues
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="../interrupts/interrupts-10.html">
            
                <a href="../interrupts/interrupts-10.html">
            
                    
                    Last part
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../SysCall/">
            
                <a href="../SysCall/">
            
                    
                    System calls
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../SysCall/syscall-1.html">
            
                <a href="../SysCall/syscall-1.html">
            
                    
                    Introduction to system calls
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../SysCall/syscall-2.html">
            
                <a href="../SysCall/syscall-2.html">
            
                    
                    How the Linux kernel handles a system call
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../SysCall/syscall-3.html">
            
                <a href="../SysCall/syscall-3.html">
            
                    
                    vsyscall and vDSO
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../SysCall/syscall-4.html">
            
                <a href="../SysCall/syscall-4.html">
            
                    
                    How the Linux kernel runs a program
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../SysCall/syscall-5.html">
            
                <a href="../SysCall/syscall-5.html">
            
                    
                    Implementation of the open system call
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../Timers/">
            
                <a href="../Timers/">
            
                    
                    Timers and time management
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../Timers/timers-1.html">
            
                <a href="../Timers/timers-1.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../Timers/timers-2.html">
            
                <a href="../Timers/timers-2.html">
            
                    
                    Clocksource framework
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../Timers/timers-3.html">
            
                <a href="../Timers/timers-3.html">
            
                    
                    The tick broadcast framework and dyntick
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../Timers/timers-4.html">
            
                <a href="../Timers/timers-4.html">
            
                    
                    Introduction to timers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../Timers/timers-5.html">
            
                <a href="../Timers/timers-5.html">
            
                    
                    Clockevents framework
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../Timers/timers-6.html">
            
                <a href="../Timers/timers-6.html">
            
                    
                    x86 related clock sources
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../Timers/timers-7.html">
            
                <a href="../Timers/timers-7.html">
            
                    
                    Time related system calls
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="./">
            
                <a href="./">
            
                    
                    Synchronization primitives
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="sync-1.html">
            
                <a href="sync-1.html">
            
                    
                    Introduction to spinlocks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="sync-2.html">
            
                <a href="sync-2.html">
            
                    
                    Queued spinlocks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="sync-3.html">
            
                <a href="sync-3.html">
            
                    
                    Semaphores
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="sync-4.html">
            
                <a href="sync-4.html">
            
                    
                    Mutex
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="sync-5.html">
            
                <a href="sync-5.html">
            
                    
                    Reader/Writer semaphores
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.7.6" data-path="sync-6.html">
            
                <a href="sync-6.html">
            
                    
                    SeqLock
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7" >
            
                <span>
            
                    
                    RCU
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8" >
            
                <span>
            
                    
                    Lockdep
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../mm/">
            
                <a href="../mm/">
            
                    
                    Memory management
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../mm/linux-mm-1.html">
            
                <a href="../mm/linux-mm-1.html">
            
                    
                    Memblock
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../mm/linux-mm-2.html">
            
                <a href="../mm/linux-mm-2.html">
            
                    
                    Fixmaps and ioremap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../mm/linux-mm-3.html">
            
                <a href="../mm/linux-mm-3.html">
            
                    
                    kmemcheck
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../Cgroups/">
            
                <a href="../Cgroups/">
            
                    
                    Cgroups
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../Cgroups/cgroups1.html">
            
                <a href="../Cgroups/cgroups1.html">
            
                    
                    Introduction to Control Groups
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" >
            
                <span>
            
                    
                    SMP
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../Concepts/">
            
                <a href="../Concepts/">
            
                    
                    Concepts
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="../Concepts/per-cpu.html">
            
                <a href="../Concepts/per-cpu.html">
            
                    
                    Per-CPU variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="../Concepts/cpumask.html">
            
                <a href="../Concepts/cpumask.html">
            
                    
                    Cpumasks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="../Concepts/initcall.html">
            
                <a href="../Concepts/initcall.html">
            
                    
                    The initcall mechanism
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../DataStructures/">
            
                <a href="../DataStructures/">
            
                    
                    Data Structures in the Linux Kernel
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="../DataStructures/dlist.html">
            
                <a href="../DataStructures/dlist.html">
            
                    
                    Doubly linked list
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="../DataStructures/radix-tree.html">
            
                <a href="../DataStructures/radix-tree.html">
            
                    
                    Radix tree
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="../DataStructures/bitmap.html">
            
                <a href="../DataStructures/bitmap.html">
            
                    
                    Bit arrays
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../Theory/">
            
                <a href="../Theory/">
            
                    
                    Theory
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="../Theory/Paging.html">
            
                <a href="../Theory/Paging.html">
            
                    
                    Paging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.2" data-path="../Theory/ELF.html">
            
                <a href="../Theory/ELF.html">
            
                    
                    Elf64
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.3" data-path="../Theory/asm.html">
            
                <a href="../Theory/asm.html">
            
                    
                    Inline assembly
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.4" >
            
                <span>
            
                    
                    CPUID
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.5" >
            
                <span>
            
                    
                    MSR
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" >
            
                <span>
            
                    
                    Initial ram disk
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" >
            
                <span>
            
                    
                    initrd
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="../Misc/">
            
                <a href="../Misc/">
            
                    
                    Misc
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.1" data-path="../Misc/how_kernel_compiled.html">
            
                <a href="../Misc/how_kernel_compiled.html">
            
                    
                    How the kernel is compiled
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.2" data-path="../Misc/linkers.html">
            
                <a href="../Misc/linkers.html">
            
                    
                    Linkers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.3" data-path="../Misc/contribute.html">
            
                <a href="../Misc/contribute.html">
            
                    
                    Linux kernel development
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.4" data-path="../Misc/program_startup.html">
            
                <a href="../Misc/program_startup.html">
            
                    
                    Program startup process in userspace
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.5" >
            
                <span>
            
                    
                    Write and Submit your first Linux kernel Patch
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.6" >
            
                <span>
            
                    
                    Data types in the kernel
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="../KernelStructures/">
            
                <a href="../KernelStructures/">
            
                    
                    KernelStructures
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1" data-path="../KernelStructures/idt.html">
            
                <a href="../KernelStructures/idt.html">
            
                    
                    IDT
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="../LINKS.html">
            
                <a href="../LINKS.html">
            
                    
                    Useful links
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18" data-path="../contributors.html">
            
                <a href="../contributors.html">
            
                    
                    Contributors
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >SeqLock</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="synchronization-primitives-in-the-linux-kernel-part-6">Synchronization primitives in the Linux kernel. Part 6.</h1>
<h2 id="introduction">Introduction</h2>
<p>This is the sixth part of the chapter which describes <a href="https://en.wikipedia.org/wiki/Synchronization_(computer_science" target="_blank">synchronization primitives</a>) in the Linux kernel and in the previous parts we finished to consider different <a href="https://en.wikipedia.org/wiki/Readers%E2%80%93writer_lock" target="_blank">readers-writer lock</a> synchronization primitives. We will continue to learn synchronization primitives in this part and start to consider a similar synchronization primitive which can be used to avoid the <code>writer starvation</code> problem. The name of this synchronization primitive is - <code>seqlock</code> or <code>sequential locks</code>.</p>
<p>We know from the previous <a href="https://0xax.gitbooks.io/linux-insides/content/SyncPrim/sync-5.html" target="_blank">part</a> that <a href="https://en.wikipedia.org/wiki/Readers%E2%80%93writer_lock" target="_blank">readers-writer lock</a> is a special lock mechanism which allows concurrent access for read-only operations, but an exclusive lock is needed for writing or modifying data. As we may guess, it may lead to a problem which is called <code>writer starvation</code>. In other words, a writer process can&apos;t acquire a lock as long as at least one reader process which aqcuired a lock holds it. So, in the situation when contention is high, it will lead to situation when a writer process which wants to acquire a lock will wait for it for a long time.</p>
<p>The <code>seqlock</code> synchronization primitive can help solve this problem.</p>
<p>As in all previous parts of this <a href="https://0xax.gitbooks.io/linux-insides/content" target="_blank">book</a>, we will try to consider this synchronization primitive from the theoretical side and only than we will consider <a href="https://en.wikipedia.org/wiki/Application_programming_interface" target="_blank">API</a> provided by the Linux kernel to manipulate with <code>seqlocks</code>.</p>
<p>So, let&apos;s start.</p>
<h2 id="sequential-lock">Sequential lock</h2>
<p>So, what is a <code>seqlock</code> synchronization primitive and how does it work? Let&apos;s try to answer on these questions in this paragraph. Actually <code>sequential locks</code> were introduced in the Linux kernel 2.6.x. Main point of this synchronization primitive is to provide fast and lock-free access to shared resources. Since the heart of <code>sequential lock</code> synchronization primitive is <a href="https://0xax.gitbooks.io/linux-insides/content/SyncPrim/sync-1.html" target="_blank">spinlock</a> synchronization primitive, <code>sequential locks</code> work in situations where the protected resources are small and simple. Additionally write access must be rare and also should be fast. </p>
<p>Work of this synchronization primitive is based on the sequence of events counter. Actually a <code>sequential lock</code> allows free access to a resource for readers, but each reader must check existence of conflicts with a writer. This synchronization primitive introduces a special counter. The main algorithm of work of <code>sequential locks</code> is simple: Each writer which acquired a sequential lock increments this counter and additionally acquires a <a href="https://0xax.gitbooks.io/linux-insides/content/SyncPrim/sync-1.html" target="_blank">spinlock</a>. When this writer finishes, it will release the acquired spinlock to give access to other writers and increment the counter of a sequential lock again.</p>
<p>Read only access works on the following principle, it gets the value of a <code>sequential lock</code> counter before it will enter into <a href="https://en.wikipedia.org/wiki/Critical_section" target="_blank">critical section</a> and compares it with the value of the same <code>sequential lock</code> counter at the exit of critical section. If their values are equal, this means that there weren&apos;t writers for this period. If their values are not equal, this means that a writer has incremented the counter during the <a href="https://en.wikipedia.org/wiki/Critical_section" target="_blank">critical section</a>. This conflict means that reading of protected data must be repeated.</p>
<p>That&apos;s all. As we may see principle of work of <code>sequential locks</code> is simple.</p>
<pre><code class="lang-C"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> seq_counter_value;

<span class="hljs-keyword">do</span> {
    seq_counter_value = get_seq_counter_val(&amp;the_lock);
    <span class="hljs-comment">//</span>
    <span class="hljs-comment">// do as we want here</span>
    <span class="hljs-comment">//</span>
} <span class="hljs-keyword">while</span> (__retry__);
</code></pre>
<p>Actually the Linux kernel does not provide <code>get_seq_counter_val()</code> function. Here it is just a stub. Like a <code>__retry__</code> too. As I already wrote above, we will see actual the <a href="https://en.wikipedia.org/wiki/Application_programming_interface" target="_blank">API</a> for this in the next paragraph of this part.</p>
<p>Ok, now we know what a <code>seqlock</code> synchronization primitive is and how it is represented in the Linux kernel. In this case, we may go ahead and start to look at the <a href="https://en.wikipedia.org/wiki/Application_programming_interface" target="_blank">API</a> which the Linux kernel provides for manipulation of synchronization primitives of this type.</p>
<h2 id="sequential-lock-api">Sequential lock API</h2>
<p>So, now we know a little about <code>sequentional lock</code> synchronization primitive from theoretical side, let&apos;s look at its implementation in the Linux kernel. All <code>sequentional locks</code> <a href="https://en.wikipedia.org/wiki/Application_programming_interface" target="_blank">API</a> are located in the <a href="https://github.com/torvalds/linux/blob/master/include/linux/seqlock.h" target="_blank">include/linux/seqlock.h</a> header file.</p>
<p>First of all we may see that the a <code>sequential lock</code> machanism is represented by the following type:</p>
<pre><code class="lang-C"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> {
    <span class="hljs-keyword">struct</span> seqcount seqcount;
    <span class="hljs-keyword">spinlock_t</span> lock;
} <span class="hljs-keyword">seqlock_t</span>;
</code></pre>
<p>As we may see the <code>seqlock_t</code> provides two fields. These fields represent a sequential lock counter, description of which we saw above and also a <a href="https://0xax.gitbooks.io/linux-insides/content/SyncPrim/sync-1.html" target="_blank">spinlock</a> which will protect data from other writers. Note that the <code>seqcount</code> counter represented as <code>seqcount</code> type. The <code>seqcount</code> is structure:</p>
<pre><code class="lang-C"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> seqcount {
    <span class="hljs-keyword">unsigned</span> sequence;
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> CONFIG_DEBUG_LOCK_ALLOC</span>
    <span class="hljs-keyword">struct</span> lockdep_map dep_map;
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
} <span class="hljs-keyword">seqcount_t</span>;
</code></pre>
<p>which holds counter of a sequential lock and <a href="https://www.kernel.org/doc/Documentation/locking/lockdep-design.txt" target="_blank">lock validator</a> related field.</p>
<p>As always in previous parts of this <a href="https://0xax.gitbooks.io/linux-insides/content/SyncPrim/" target="_blank">chapter</a>, before we will consider an <a href="https://en.wikipedia.org/wiki/Application_programming_interface" target="_blank">API</a> of <code>sequential lock</code> mechanism in the Linux kernel, we need to know how to initialize an instance of <code>seqlock_t</code>.</p>
<p>We saw in the previous parts that often the Linux kernel provides two approaches to execute initialization of the given synchronization primitive. The same situation with the <code>seqlock_t</code> structure. These approaches allows to initialize a <code>seqlock_t</code> in two following:</p>
<ul>
<li><code>statically</code>;</li>
<li><code>dynamically</code>.</li>
</ul>
<p>ways. Let&apos;s look at the first approach. We are able to intialize a <code>seqlock_t</code> statically with the <code>DEFINE_SEQLOCK</code> macro:</p>
<pre><code class="lang-C"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEFINE_SEQLOCK(x) \
        seqlock_t x = __SEQLOCK_UNLOCKED(x)</span>
</code></pre>
<p>which is defined in the <a href="https://github.com/torvalds/linux/blob/master/include/linux/seqlock.h" target="_blank">include/linux/seqlock.h</a> header file. As we may see, the <code>DEFINE_SEQLOCK</code> macro takes one argument and expands to the definition and initialization of the <code>seqlock_t</code> structure. Initialization occurs with the help of the <code>__SEQLOCK_UNLOCKED</code> macro which is defined in the same source code file. Let&apos;s look at the implementation of this macro:</p>
<pre><code class="lang-C"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __SEQLOCK_UNLOCKED(lockname)            \
    {                        \
        .seqcount = SEQCNT_ZERO(lockname),    \
        .lock =    __SPIN_LOCK_UNLOCKED(lockname)    \
    }</span>
</code></pre>
<p>As we may see the, <code>__SEQLOCK_UNLOCKED</code> macro executes initialization of fields of the given <code>seqlock_t</code> structure. The first field is <code>seqcount</code> initialized with the <code>SEQCNT_ZERO</code> macro which expands to the:</p>
<pre><code class="lang-C"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SEQCNT_ZERO(lockname) { .sequence = 0, SEQCOUNT_DEP_MAP_INIT(lockname)}</span>
</code></pre>
<p>So we just initialize counter of the given sequential lock to zero and additionally we can see <a href="https://www.kernel.org/doc/Documentation/locking/lockdep-design.txt" target="_blank">lock validator</a> related initialization which depends on the state of the <code>CONFIG_DEBUG_LOCK_ALLOC</code> kernel configuration option:</p>
<pre><code class="lang-C"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> CONFIG_DEBUG_LOCK_ALLOC</span>
<span class="hljs-meta"># <span class="hljs-meta-keyword">define</span> SEQCOUNT_DEP_MAP_INIT(lockname) \
    .dep_map = { .name = #lockname } \
    ...</span>
    ...
    ...
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
<span class="hljs-meta"># <span class="hljs-meta-keyword">define</span> SEQCOUNT_DEP_MAP_INIT(lockname)</span>
    ...
    ...
    ...
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
</code></pre>
<p>As I already wrote in previous parts of this <a href="https://0xax.gitbooks.io/linux-insides/content/SyncPrim/" target="_blank">chapter</a> we will not consider <a href="https://en.wikipedia.org/wiki/Debugging" target="_blank">debugging</a> and <a href="https://www.kernel.org/doc/Documentation/locking/lockdep-design.txt" target="_blank">lock validator</a> related stuff in this part. So for now we just skip the <code>SEQCOUNT_DEP_MAP_INIT</code> macro. The second field of the given <code>seqlock_t</code> is <code>lock</code> initialized with the <code>__SPIN_LOCK_UNLOCKED</code> macro which is defined in the <a href="https://github.com/torvalds/linux/blob/master/include/linux/spinlock_types.h" target="_blank">include/linux/spinlock_types.h</a> header file. We will not consider implementation of this macro here as it just initialize <a href="https://0xax.gitbooks.io/linux-insides/content/SyncPrim/sync-1.html" target="_blank">rawspinlock</a> with architecture-specific methods (More abot spinlocks you may read in first parts of this <a href="https://0xax.gitbooks.io/linux-insides/content/SyncPrim/" target="_blank">chapter</a>).</p>
<p>We have considered the first way to initialize a sequential lock. Let&apos;s consider second way to do the same, but do it dynamically. We can initialize a sequentional lock with the <code>seqlock_init</code> macro which is defined in the same  <a href="https://github.com/torvalds/linux/blob/master/include/linux/seqlock.h" target="_blank">include/linux/seqlock.h</a> header file.</p>
<p>Let&apos;s look at the implementation of this macro:</p>
<pre><code class="lang-C"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> seqlock_init(x)                    \
    do {                        \
        seqcount_init(&amp;(x)-&gt;seqcount);        \
        spin_lock_init(&amp;(x)-&gt;lock);        \
    } while (0)</span>
</code></pre>
<p>As we may see, the <code>seqlock_init</code> expands into two macros. The first macro <code>seqcount_init</code> takes counter of the given sequential lock and expands to the call of the <code>__seqcount_init</code> function:</p>
<pre><code class="lang-C"><span class="hljs-meta"># <span class="hljs-meta-keyword">define</span> seqcount_init(s)                \
    do {                        \
        static struct lock_class_key __key;    \
        __seqcount_init((s), #s, &amp;__key);    \
    } while (0)</span>
</code></pre>
<p>from the same header file. This function</p>
<pre><code class="lang-C"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> __seqcount_init(<span class="hljs-keyword">seqcount_t</span> *s, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name,
                      <span class="hljs-keyword">struct</span> lock_class_key *key)
{
    lockdep_init_map(&amp;s-&gt;dep_map, name, key, <span class="hljs-number">0</span>);
    s-&gt;sequence = <span class="hljs-number">0</span>;
}
</code></pre>
<p>just initializes counter of the given <code>seqcount_t</code> with zero. The second call from the <code>seqlock_init</code> macro is the call of the <code>spin_lock_init</code> macro which we saw in the <a href="https://0xax.gitbooks.io/linux-insides/content/SyncPrim/sync-1.html" target="_blank">first part</a> of this chapter.</p>
<p>So, now we know how to initialize a <code>sequential lock</code>, now let&apos;s look at how to use it. The Linux kernel provides following <a href="https://en.wikipedia.org/wiki/Application_programming_interface" target="_blank">API</a> to manipulate <code>sequential locks</code>:</p>
<pre><code class="lang-C"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-title">read_seqbegin</span><span class="hljs-params">(<span class="hljs-keyword">const</span> seqlock_t *sl)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-title">read_seqretry</span><span class="hljs-params">(<span class="hljs-keyword">const</span> seqlock_t *sl, <span class="hljs-keyword">unsigned</span> start)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">write_seqlock</span><span class="hljs-params">(seqlock_t *sl)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">write_sequnlock</span><span class="hljs-params">(seqlock_t *sl)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">write_seqlock_irq</span><span class="hljs-params">(seqlock_t *sl)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">write_sequnlock_irq</span><span class="hljs-params">(seqlock_t *sl)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">read_seqlock_excl</span><span class="hljs-params">(seqlock_t *sl)</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">read_sequnlock_excl</span><span class="hljs-params">(seqlock_t *sl)</span>
</span></code></pre>
<p>and others. Before we move on to considering the implementation of this <a href="https://en.wikipedia.org/wiki/Application_programming_interface" target="_blank">API</a>, we must know that actually there are two types of readers. The first type of reader never blocks a writer process. In this case writer will not wait for readers. The second type of reader which can lock. In this case, the locking reader will block the writer as it will wait while reader will not release its lock.</p>
<p>First of all let&apos;s consider the first type of readers. The <code>read_seqbegin</code> function begins a seq-read <a href="https://en.wikipedia.org/wiki/Critical_section" target="_blank">critical section</a>.</p>
<p>As we may see this function just returns value of the <code>read_seqcount_begin</code> function:</p>
<pre><code class="lang-C"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-title">read_seqbegin</span><span class="hljs-params">(<span class="hljs-keyword">const</span> seqlock_t *sl)</span>
</span>{
    <span class="hljs-keyword">return</span> read_seqcount_begin(&amp;sl-&gt;seqcount);
}
</code></pre>
<p>In its turn the <code>read_seqcount_begin</code> function calls the <code>raw_read_seqcount_begin</code> function:</p>
<pre><code class="lang-C"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-title">read_seqcount_begin</span><span class="hljs-params">(<span class="hljs-keyword">const</span> seqcount_t *s)</span>
</span>{
    <span class="hljs-keyword">return</span> raw_read_seqcount_begin(s);
}
</code></pre>
<p>which just returns value of the <code>sequential lock</code> counter:</p>
<pre><code class="lang-C"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-title">raw_read_seqcount</span><span class="hljs-params">(<span class="hljs-keyword">const</span> seqcount_t *s)</span>
</span>{
    <span class="hljs-keyword">unsigned</span> ret = READ_ONCE(s-&gt;sequence);
    smp_rmb();
    <span class="hljs-keyword">return</span> ret;
}
</code></pre>
<p>After we have the initial value of the given <code>sequential lock</code> counter and did some stuff, we know from the previous paragraph of this function, that we need to compare it with the current value of the counter the same <code>sequential lock</code> before we will exit from the critical section. We can achieve this by the call of the <code>read_seqretry</code> function. This function takes a <code>sequential lock</code>, start value of the counter and through a chain of functions:</p>
<pre><code class="lang-C"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-title">read_seqretry</span><span class="hljs-params">(<span class="hljs-keyword">const</span> seqlock_t *sl, <span class="hljs-keyword">unsigned</span> start)</span>
</span>{
    <span class="hljs-keyword">return</span> read_seqcount_retry(&amp;sl-&gt;seqcount, start);
}

<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">int</span> <span class="hljs-title">read_seqcount_retry</span><span class="hljs-params">(<span class="hljs-keyword">const</span> seqcount_t *s, <span class="hljs-keyword">unsigned</span> start)</span>
</span>{
    smp_rmb();
    <span class="hljs-keyword">return</span> __read_seqcount_retry(s, start);
}
</code></pre>
<p>it calls the <code>__read_seqcount_retry</code> function:</p>
<pre><code class="lang-C"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">int</span> __read_seqcount_retry(<span class="hljs-keyword">const</span> <span class="hljs-keyword">seqcount_t</span> *s, <span class="hljs-keyword">unsigned</span> start)
{
    <span class="hljs-keyword">return</span> unlikely(s-&gt;sequence != start);
}
</code></pre>
<p>which just compares value of the counter of the given <code>sequential lock</code> with the initial value of this counter. If the initial value of the counter which is obtained from <code>read_seqbegin()</code> function is odd, this means that a writer was in the middle of updating the data when our reader began to act. In this case the value of the data can be in inconsistent state, so we need to try to read it again.</p>
<p>This is a common pattern in the Linux kernel. For example, you may remember the <code>jiffies</code> concept from the <a href="https://0xax.gitbooks.io/linux-insides/content/Timers/timers-1.html" target="_blank">first part</a> of the <a href="https://0xax.gitbooks.io/linux-insides/content/Timers/" target="_blank">timers and time management in the Linux kernel</a> chapter. The sequential lock is used to obtain value of <code>jiffies</code> at <a href="https://en.wikipedia.org/wiki/X86-64" target="_blank">x86_64</a> architecture:</p>
<pre><code class="lang-C"><span class="hljs-function">u64 <span class="hljs-title">get_jiffies_64</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{
    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> seq;
    u64 ret;

    <span class="hljs-keyword">do</span> {
        seq = read_seqbegin(&amp;jiffies_lock);
        ret = jiffies_64;
    } <span class="hljs-keyword">while</span> (read_seqretry(&amp;jiffies_lock, seq));
    <span class="hljs-keyword">return</span> ret;
}
</code></pre>
<p>Here we just read the value of the counter of the <code>jiffies_lock</code> sequential lock and then we write value of the <code>jiffies_64</code> system variable to the <code>ret</code>. As here we may see <code>do/while</code> loop, the body of the loop will be executed at least one time. So, as the body of loop was executed, we read and compare the current value of the counter of the <code>jiffies_lock</code> with the initial value. If these values are not equal, execution of the loop will be repeated, else <code>get_jiffies_64</code> will return its value in <code>ret</code>.</p>
<p>We just saw the first type of readers which do not block writer and other readers. Let&apos;s consider second type. It does not update value of a <code>sequential lock</code> counter, but just locks <code>spinlock</code>:</p>
<pre><code class="lang-C"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">read_seqlock_excl</span><span class="hljs-params">(seqlock_t *sl)</span>
</span>{
    spin_lock(&amp;sl-&gt;lock);
}
</code></pre>
<p>So, no one reader or writer can&apos;t access protected data. When a reader finishes, the lock must be unlocked with the:</p>
<pre><code class="lang-C"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">read_sequnlock_excl</span><span class="hljs-params">(seqlock_t *sl)</span>
</span>{
    spin_unlock(&amp;sl-&gt;lock);
}
</code></pre>
<p>function.</p>
<p>Now we know how <code>sequential lock</code> work for readers. Let&apos;s consider how does writer act when it wants to acquire a <code>sequential lock</code> to modify data. To acquire a <code>sequential lock</code>, writer should use <code>write_seqlock</code> function. If we look at the implementation of this function:</p>
<pre><code class="lang-C"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">write_seqlock</span><span class="hljs-params">(seqlock_t *sl)</span>
</span>{
    spin_lock(&amp;sl-&gt;lock);
    write_seqcount_begin(&amp;sl-&gt;seqcount);
}
</code></pre>
<p>We will see that it acquires <code>spinlock</code> to prevent access from other writers and calls the <code>write_seqcount_begin</code> function. This function just increments value of the <code>sequential lock</code> counter:</p>
<pre><code class="lang-C"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">raw_write_seqcount_begin</span><span class="hljs-params">(seqcount_t *s)</span>
</span>{
    s-&gt;sequence++;
    smp_wmb();
}
</code></pre>
<p>When a writer process will finish to modify data, the <code>write_sequnlock</code> function must be called to release a lock and give access to other writers or readers. Let&apos;s consider at the implementation of the <code>write_sequnlock</code> function. It looks pretty simple:</p>
<pre><code class="lang-C"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">write_sequnlock</span><span class="hljs-params">(seqlock_t *sl)</span>
</span>{
    write_seqcount_end(&amp;sl-&gt;seqcount);
    spin_unlock(&amp;sl-&gt;lock);
}
</code></pre>
<p>First of all it just calls <code>write_seqcount_end</code> function to increase value of the counter of the <code>sequential</code> lock again:</p>
<pre><code class="lang-C"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">raw_write_seqcount_end</span><span class="hljs-params">(seqcount_t *s)</span>
</span>{
    smp_wmb();
    s-&gt;sequence++;
}
</code></pre>
<p>and in the end we just call the <code>spin_unlock</code> macro to give access for other readers or writers.</p>
<p>That&apos;s all about <code>sequential lock</code> mechanism in the Linux kernel. Of course we did not consider full <a href="https://en.wikipedia.org/wiki/Application_programming_interface" target="_blank">API</a> of this mechanism in this part. But all other functions are based on these which we described here. For example, Linux kernel also provides some safe macros/functions to use <code>sequential lock</code> mechanism in <a href="https://en.wikipedia.org/wiki/Interrupt_handler" target="_blank">interrupt handlers</a> of <a href="https://0xax.gitbooks.io/linux-insides/content/interrupts/interrupts-9.html" target="_blank">softirq</a>: <code>write_seqclock_irq</code> and <code>write_sequnlock_irq</code>:</p>
<pre><code class="lang-C"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">write_seqlock_irq</span><span class="hljs-params">(seqlock_t *sl)</span>
</span>{
    spin_lock_irq(&amp;sl-&gt;lock);
    write_seqcount_begin(&amp;sl-&gt;seqcount);
}

<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">write_sequnlock_irq</span><span class="hljs-params">(seqlock_t *sl)</span>
</span>{
    write_seqcount_end(&amp;sl-&gt;seqcount);
    spin_unlock_irq(&amp;sl-&gt;lock);
}
</code></pre>
<p>As we may see, these functions differ only in the initialization of spinlock. They call <code>spin_lock_irq</code> and <code>spin_unlock_irq</code> instead of <code>spin_lock</code> and <code>spin_unlock</code>.</p>
<p>Or for example <code>write_seqlock_irqsave</code> and <code>write_sequnlock_irqrestore</code> functions which are the same but used <code>spin_lock_irqsave</code> and <code>spin_unlock_irqsave</code> macro to use in <a href="https://en.wikipedia.org/wiki/Interrupt_request_(PC_architecture" target="_blank">IRQ</a>) handlers.</p>
<p>That&apos;s all.</p>
<h2 id="conclusion">Conclusion</h2>
<p>This is the end of the sixth part of the <a href="https://en.wikipedia.org/wiki/Synchronization_%28computer_science%29" target="_blank">synchronization primitives</a> chapter in the Linux kernel. In this part we met with new synchronization primitive which is called - <code>sequential lock</code>. From the theoretical side, this synchronization primitive very similar on a <a href="https://en.wikipedia.org/wiki/Readers%E2%80%93writer_lock" target="_blank">readers-writer lock</a> synchronization primitive, but allows to avoid <code>writer-starving</code> issue.</p>
<p>If you have questions or suggestions, feel free to ping me in twitter <a href="https://twitter.com/0xAX" target="_blank">0xAX</a>, drop me <a href="anotherworldofworld@gmail.com">email</a> or just create <a href="https://github.com/0xAX/linux-insides/issues/new" target="_blank">issue</a>.</p>
<p><strong>Please note that English is not my first language and I am really sorry for any inconvenience. If you found any mistakes please send me PR to <a href="https://github.com/0xAX/linux-insides" target="_blank">linux-insides</a>.</strong></p>
<h2 id="links">Links</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Synchronization_(computer_science" target="_blank">synchronization primitives</a>)</li>
<li><a href="https://en.wikipedia.org/wiki/Readers%E2%80%93writer_lock" target="_blank">readers-writer lock</a> </li>
<li><a href="https://0xax.gitbooks.io/linux-insides/content/SyncPrim/sync-1.html" target="_blank">spinlock</a></li>
<li><a href="https://en.wikipedia.org/wiki/Critical_section" target="_blank">critical section</a></li>
<li><a href="https://www.kernel.org/doc/Documentation/locking/lockdep-design.txt" target="_blank">lock validator</a></li>
<li><a href="https://en.wikipedia.org/wiki/Debugging" target="_blank">debugging</a></li>
<li><a href="https://en.wikipedia.org/wiki/Application_programming_interface" target="_blank">API</a></li>
<li><a href="https://en.wikipedia.org/wiki/X86-64" target="_blank">x86_64</a></li>
<li><a href="https://0xax.gitbooks.io/linux-insides/content/Timers/" target="_blank">Timers and time management in the Linux kernel</a></li>
<li><a href="https://en.wikipedia.org/wiki/Interrupt_handler" target="_blank">interrupt handlers</a></li>
<li><a href="https://0xax.gitbooks.io/linux-insides/content/interrupts/interrupts-9.html" target="_blank">softirq</a></li>
<li><a href="https://en.wikipedia.org/wiki/Interrupt_request_(PC_architecture" target="_blank">IRQ</a>)</li>
<li><a href="https://0xax.gitbooks.io/linux-insides/content/SyncPrim/sync-5.html" target="_blank">Previous part</a></li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="sync-5.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Reader/Writer semaphores">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"SeqLock","level":"1.7.6","depth":2,"next":{"title":"RCU","level":"1.7.7","depth":2,"ref":"","articles":[]},"previous":{"title":"Reader/Writer semaphores","level":"1.7.5","depth":2,"path":"SyncPrim/sync-5.md","ref":"SyncPrim/sync-5.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"SyncPrim/sync-6.md","mtime":"2019-03-28T07:54:50.402Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-03-28T08:16:32.758Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

